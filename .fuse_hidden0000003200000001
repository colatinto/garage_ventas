#!/bin/bash
# Setup automรกtico para Netlify

echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo "โ     ๐ CONFIGURACIรN AUTOMรTICA - NETLIFY                  โ"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo ""

# Verificar si npm estรก instalado
if ! command -v npm &> /dev/null; then
    echo "โ npm no estรก instalado"
    echo ""
    echo "Instalรก Node.js primero desde: https://nodejs.org/"
    echo "O con Homebrew: brew install node"
    exit 1
fi

echo "๐ฆ Instalando Netlify CLI..."
npm install -g netlify-cli

echo ""
echo "๐ Ahora necesitรกs hacer login en Netlify..."
echo "Se va a abrir tu navegador para autenticar."
echo ""
read -p "Presionรก Enter para continuar..."

netlify login

echo ""
echo "๐ Conectando tu sitio existente..."
echo ""
cd dashboard_web

# Link al sitio existente
echo "๐ Copiรก el Site ID de tu sitio:"
echo "   1. Andรก a: https://app.netlify.com"
echo "   2. Click en tu sitio (snazzy-platypus-56587c)"
echo "   3. Site settings โ General"
echo "   4. Copiรก el 'Site ID' (algo como: 12345678-abcd-1234-abcd-123456789012)"
echo ""
read -p "Pegรก tu Site ID acรก: " site_id

# Crear archivo de configuraciรณn
cat > .netlify/state.json << EOF
{
  "siteId": "$site_id"
}
EOF

mkdir -p .netlify
echo "$site_id" > .netlify/site-id.txt

echo ""
echo "โ Sitio conectado!"
echo ""
echo "๐งช Probando deploy..."
netlify deploy --prod --dir .

if [ $? -eq 0 ]; then
    echo ""
    echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
    echo "โ  ๐ ยกCONFIGURACIรN EXITOSA!                                โ"
    echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
    echo ""
    echo "โ Tu sitio: https://snazzy-platypus-56587c.netlify.app/"
    echo ""
    echo "๐ De ahora en adelante, cada vez que ejecutes:"
    echo "   ./actualizar_web.sh"
    echo ""
    echo "   Se subirรก automรกticamente a Netlify"
    echo ""
else
    echo "โ Hubo un error con el deploy"
    echo "Verificรก el Site ID y tu conexiรณn a internet"
fi
