#!/bin/bash
# Script para actualizar el dashboard web automÃ¡ticamente

cd "$(dirname "$0")"

echo "ğŸ”„ Actualizando dashboard web..."

# Crear carpeta web si no existe
mkdir -p dashboard_web

# Exportar datos actualizados desde la BD
source venv/bin/activate
python3 << 'EOF'
from sales_extractor_v2 import SalesDataExtractor
try:
    extractor = SalesDataExtractor('config.json')
    extractor.export_dashboard_data()
    print("âœ… Datos exportados desde BD")
except Exception as e:
    print(f"âš ï¸  Error exportando datos: {e}")
EOF

# Copiar archivos necesarios
cp dashboard_pro.html dashboard_web/index.html
cp dashboard_data.json dashboard_web/

echo "âœ… Archivos actualizados en dashboard_web/"

# Si existe el repositorio git, hacer push automÃ¡tico
if [ -d "dashboard_web/.git" ]; then
    cd dashboard_web
    git add .
    git commit -m "ActualizaciÃ³n automÃ¡tica $(date '+%Y-%m-%d %H:%M')" 2>/dev/null

    if git push origin main 2>/dev/null; then
        echo "âœ… Dashboard publicado en GitHub Pages"
        echo "   Tus socios verÃ¡n los cambios en 1-2 minutos"
    else
        echo "âš ï¸  No se pudo hacer push (verificÃ¡ la conexiÃ³n a internet)"
    fi
else
    echo ""
    echo "ğŸ“¤ Para configurar actualizaciÃ³n automÃ¡tica:"
    echo "   EjecutÃ¡: ./SETUP_AUTO_GITHUB.sh"
    echo ""
    echo "ğŸ“¤ O subir manualmente a Netlify:"
    echo "   ArrastrÃ¡ la carpeta dashboard_web/ al sitio de Netlify"
fi

echo ""
echo "âœ… ActualizaciÃ³n completada - $(date '+%H:%M:%S')"
